$(window).on('resize scroll load', function(i) {

	//Resize container pad
	var containerPad = Math.round($('.container').innerWidth()/12)
	$('.pad').css({'padding-left' : containerPad, 'padding-right' : containerPad});

	// Lazy Load
    var scroll = $(window).scrollTop() + $(window).height();

    $('.work_thumb').each(function(){

        var lazy = $(this);

        if ( lazy.offset().top < scroll) {
            var dataBg = new Image();
            dataBg.addEventListener('load', function() {
                lazy.css({'background-image' : 'url(' + dataBg.src + ')'});
            }, false);
            dataBg.src = lazy.data('bg');
        }

    });

});

$(window).on('load', function(){

	// Isotope
	var categoryFilters = [];
	var categoryFilter;

	// init Isotope
	var $isotope = $('.isotope').isotope({
		layoutMode: 'fitRows',
		itemSelector: '.isotope__item'
	});

	function filterSearch() {
		$isotope.isotope({
			filter: function() {
				return qsRegex ? $(this).text().match( qsRegex ) : true;
			}
		});
	};

	function filterTags() {
		$isotope.isotope({
			filter: function() {
				var length = categoryFilters.length;
				if ( !length ) {
					return true;
				}
				var $this = $(this);
				// check if all category filter match
				for ( var i=0; i<length; i++ ) {
					var catFilter = categoryFilters[i];
					if ( !$this.is('[data-filter*=' + catFilter + ']') ) {
						return false;
					}
				}
				// otherwise match
				return true;
			}
		});
	};

	// filter with checkboxes
	var $tag_wrap = $('.tag_wrap input');

	function changeFilters() {
		categoryFilters = [];
		$tag_wrap.each( function( i, elem ) {
			if ( elem.checked ) {
				categoryFilters.push( elem.value );
			}
			$isotope.isotope();
		});
	};

	$tag_wrap.change( function() {
		filterTags();
		changeFilters();
	});

	$('.tag_wrap__reset').click(function() {
		$tag_wrap.prop('checked', false)
	});

	// Search
	$('.tag_wrap__search').click(function() {
		filterSearch();
		$tag_wrap.prop('checked', false)
		changeFilters();
	});

	// quick search regex
	var qsRegex;

	// use value of search field to filter
	var $tag_wrap__search = $('.tag_wrap__search').keyup( debounce( function() {
		qsRegex = new RegExp( $tag_wrap__search.val(), 'gi' );
		$isotope.isotope();
	}, 200 ) );

	// debounce so filtering doesn't happen every millisecond
	function debounce( fn, threshold ) {
		var timeout;
	return function debounced() {
		if ( timeout ) {
		clearTimeout( timeout );
	}
	function delayed() {
		fn();
		timeout = null;
	}
		timeout = setTimeout( delayed, threshold || 100 );
	}
	}

	// Isotope Hash
	var isotope__hash = "isotope__tag--" + window.location.hash.substring(1);

	if(window.location.hash) {
		categoryFilters = [];
		categoryFilters.push(isotope__hash);
		$('#' + isotope__hash).prop('checked', true);
		filterTags();
	}

	// Hamburger trigger
	$('.header__trigger').click(function(){
		$(this).toggleClass('header__trigger--expand');
		$('.header__trigger__text').toggleClass('header__trigger__text--expand');
		$('.header__trigger__icon').toggleClass('header__trigger__icon--expand');
		$('.nav__wrap').toggleClass('nav__wrap--expand');
	});

	// Searchbar
	$('.tag_wrap__search__wrap').click(function(){
		$(this).find('input.tag_wrap__search').focus();
	});

	// Work hover FX
	$('.work_thumb').mousemove(function() {
		var off = $(this).offset();
		var h = $(this).height() / 2;
		var w = $(this).width() / 2;
		var x = event.pageY - off.top - h;
		var y = event.pageX - off.left - w;
		var xDeg = - (x * (Math.PI / 180));
		var yDeg = y * (Math.PI / 180);
		var rad = Math.atan2(x,y);
		var radPI = rad * 180 / Math.PI - 90;
		$(this).css({
			'transform' : 'scale3d(1.0125,1.0125,1.0125)',
		});
		$(this).find('.lux').css('background', 'linear-gradient(' + radPI + 'deg, rgba(10,10,10,0.5) 0%,rgba(0,0,0,.66) 80%)' );
	});
	$('.work_thumb').mouseout(function() {
		$(this).css({
			'transform' : 'scale3d(1,1,1)',
		});
		$(this).find('.lux').css('background', 'none' );
	});
	
		// Service hover FX
	$('.service_thumb').mousemove(function() {
		var off = $(this).offset();
		var h = $(this).height() / 2;
		var w = $(this).width() / 2;
		var x = event.pageY - off.top - h;
		var y = event.pageX - off.left - w;
		var xDeg = - (x * (Math.PI / 180));
		var yDeg = y * (Math.PI / 180);
		var rad = Math.atan2(x,y);
		var radPI = rad * 180 / Math.PI - 90;
		$(this).css({
			'transform' : 'scale3d(1.0125,1.0125,1.0125)',
		});
		$(this).find('.lux').css('background', 'linear-gradient(' + radPI + 'deg, rgba(10,10,10,0.5) 0%,rgba(0,0,0,.66) 80%)' );
	});
	$('.service_thumb').mouseout(function() {
		$(this).css({
			'transform' : 'scale3d(1,1,1)',
		});
		$(this).find('.lux').css('background', 'none' );
	});

	// Fitvid
	$('.fitvids').fitVids();
	$('.content').fitVids();

	// Smooth Scrolling
	$('a[href*="#"]')
	.not('[href="#"]')
	.not('[href="#0"]')
	.click(function(event) {
		if (
		location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '')
		&&
		location.hostname == this.hostname
		) {
			var target = $(this.hash);
			target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
			if (target.length) {
				event.preventDefault();
			$('html, body').animate({
				scrollTop: target.offset().top
			}, 1000, function() {
				var $target = $(target);
				$target.focus();
				if ($target.is(":focus")) {
					return false;
				} else {
					$target.attr('tabindex','-1');
					$target.focus();
				};
				});
			}
		}
	});

	// AJAX Popup
	$('.ajax').magnificPopup({
		disableOn: 700,
		type: 'iframe',
		mainClass: 'mfp-fade',
		removalDelay: 160,
		preloader: false,
		fixedContentPos: false
	});

	$('.loader').fadeOut();

});
